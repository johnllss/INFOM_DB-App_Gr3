{% extends "layout.html" %}

{% block title %}
    Fairway Booking
{% endblock %}

{% block main %}
<div class="container-fluid px-5">
    
    <form action="/booking-fairway" method="post">
        
        <div class="row">
            <h1 class="text-left display-3 fw-bold mt-4 mb-5">
                Fairway Booking
            </h1>

            <div class="col-lg-7 col-md-12">
    
                <div class="row align-items-end mb-4">
                    
                    <div class="col-md-3">
                        <label for="date-selector" class="form-label fw-bold">Date</label>
                        <input type="date" id="date-selector" name="booking-date" class="form-select">
                    </div>
                    
                    <div class="col-md-3">
                        <label for="time-selector" class="form-label fw-bold">Time</label>
                        <select class="form-select" name="booking-time">
                            <option value="07:00">7:00 AM</option>
                            <option value="09:00">9:00 AM</option>
                            <option value="11:00">11:00 AM</option>
                            <option value="13:00">1:00 PM</option>
                            <option value="15:00">3:00 PM</option>
                            <option value="17:00">5:00 PM</option>
                        </select>
                    </div>

                    <div class="col-md-3">
                        <label for="hole-selector" class="form-label fw-bold">Type</label>
                        <select class="form-select" name="booking-hole">
                            <option value="18">FULL 18</option>
                            <option value="9B">9 BACK</option>
                            <option value="9F">9 FRONT</option>
                        </select>
                    </div>

                    <div class="col-md-3">
                        <p class="h5 fw-bold text-success mb-0 pb-1">
                            Available
                        </p>
                    </div>
                </div>

                <hr class="my-4">

                <div class="row mb-4">
                    <label for="coach-selector" class="form-label fw-bold">Coach</label>
                    <div class="col-md-12">
                        <div class="row align-items-center">
                            <div class="col-8">
                                <select class="form-select" name="booking-coach" id="coach-selector">
                                    <option value="0">No Coach</option>
                                    {% for co in coach %}
                                        <option value="{{ co.staff_id }}" data-status="{{ co.status }}">
                                            {{ co.name }}
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-4">
                                <p class="h5 fw-bold mb-0" id="coach-availability"></p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mb-4">
                    <label for="caddie-selector" class="form-label fw-bold">Caddie</label>
                    <div class="col-md-12">
                        <div class="row align-items-center">
                            <div class="col-8">
                                <select class="form-select" name="booking-caddie" id="caddie-selector">
                                    <option value="0">No Caddie</option>
                                    {% for ca in caddie %}
                                        <option value="{{ ca.staff_id }}" data-status="{{ ca.status }}">
                                            {{ ca.name }}
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-4">
                                <p class="h5 fw-bold mb-0" id="caddie-availability"></p>
                            </div>
                        </div>
                    </div>
                </div>

                <hr class="my-4">

            </div>

            <div class="col-lg-5 col-md-12">
                <div class="border rounded p-4">
                    <h3 class="mb-4">Order Summary</h3>

                    <div class="d-flex justify-content-between mb-2">
                        <span>Round</span>
                        <strong>P67</strong>
                    </div>

                    <div class="d-flex justify-content-between mb-2">
                        <span>Coach</span>
                        <strong>P67</strong>
                    </div>

                    <div class="d-flex justify-content-between mb-3">
                        <span>Caddie</span>
                        <strong>P67</strong>
                    </div>

                    <hr>

                    <div class="d-flex justify-content-between h4 fw-bold my-3">
                        <span>Total</span>
                        <span>P67</span>
                    </div>
                    
                    <button class="btn btn-green w-100" type="submit">Checkout Now</button>
                </div>
            </div>

        </div> 
    </form> 
</div> 

<script>
    function checkStaffAvailability(selectorId, availabilityId) {
        
        const selector = document.getElementById(selectorId);
        const availabilityText = document.getElementById(availabilityId);
        const selectedOption = selector.options[selector.selectedIndex];
        const selectedStaffId = selectedOption.value;

        if (selectedStaffId === "0") {
            availabilityText.textContent = ""; 
            return;
        }

        // read the string
        const staffStatus = selectedOption.dataset.status;

        // updated selected element
        if (staffStatus === 'Available') {
            availabilityText.textContent = 'Available';
            availabilityText.className = 'h5 fw-bold text-success mb-0';
        } else {
            availabilityText.textContent = 'Occupied'; 
            availabilityText.className = 'h5 fw-bold text-danger mb-0';
        }
    }

    // 3. ATTACH EVENT LISTENERS
    const coachSelector = document.getElementById('coach-selector');
    const caddieSelector = document.getElementById('caddie-selector');

    coachSelector.addEventListener('change', () => {
        checkStaffAvailability('coach-selector', 'coach-availability');
    });
    caddieSelector.addEventListener('change', () => {
        checkStaffAvailability('caddie-selector', 'caddie-availability');
    });

    // 4. RUN ON PAGE LOAD
    checkStaffAvailability('coach-selector', 'coach-availability');
    checkStaffAvailability('caddie-selector', 'caddie-availability');
</script>
{% endblock %}